<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Codex Dominus</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#3f51b5" />
  <link rel="icon" href="icon-192.png" />
</head>
<body>

  <div id="chat-container">

    <!-- Banner de InstalaÃ§Ã£o -->
    <div id="install-banner" class="hidden">
      <span id="close-install-banner">âœ–</span>
      <button id="btn-install">ğŸ“² Instalar Codex Dominus</button>
    </div>

    <!-- Chat -->
    <div id="messages"></div>

    <!-- Barra Inferior -->
    <form id="chat-form">

      <!-- Menu de AÃ§Ãµes -->
      <div id="action-container">
        <button type="button" id="open-actions" title="AÃ§Ãµes">ğŸ²</button>
        <div id="action-menu" class="hidden">
          <button type="button" class="settings-option" id="btn-scenarios">ğŸŒ CenÃ¡rios</button>
          <hr>
          <button type="button" class="action-option" data-action="plot">ğŸ“œ Trama</button>
          <button type="button" class="action-option" data-action="archetype">ğŸ§™ ArquÃ©tipo</button>
          <button type="button" class="action-option" data-action="scene">ğŸ¬ Cena</button>
          <button type="button" class="action-option" data-action="idea-bank">ğŸ’¡ Banco de Ideias</button>
          <button type="button" class="action-option" data-action="extras">âœ¨ Extras</button>
          <hr>
          <button type="button" class="action-option" data-action="roll-1d6">ğŸ² Rolar 1d6</button>
          <button type="button" class="action-option" data-action="roll-2d6">ğŸ² Rolar 2d6</button>
          <button type="button" class="action-option" data-action="ask-oracle">ğŸ”® OrÃ¡culo</button>
        </div>
      </div>

      <!-- Input de mensagem -->
      <input type="text" id="message-input" placeholder="Digite sua mensagem..." autocomplete="off" inputmode="text"/>
      <button type="submit"><strong>â¤</strong></button>
      
      <!-- Menu de ConfiguraÃ§Ãµes -->
      <div id="settings-container">
        <button type="button" id="open-settings" title="ConfiguraÃ§Ãµes">âš™ï¸</button>
        <div id="settings-menu" class="hidden">
          <button type="button" class="settings-option" id="btn-about">â„¹ï¸ Sobre</button>
          <button type="button" class="settings-option" id="btn-rules">ğŸ“ƒ Regras</button>
          <hr>
          <button type="button" class="settings-option" id="btn-settings">âš™ï¸ ConfiguraÃ§Ãµes</button>
          <hr>
          <button type="button" class="settings-option" id="btn-undo">â¤º Desfazer</button>
          <button type="button" class="settings-option" id="btn-clear">ğŸ—‘ï¸ Limpar</button>
        </div>
      </div>

    </form>

  </div>

  <!-- Modal: CenÃ¡rios -->
  <section id="modal-scenarios" class="modal hidden">
    <div class="modal-content">
      <h2>CenÃ¡rios Codex Dominus</h2>
      <p>Escolha entre 1 e 3 cenÃ¡rios para jogar. Os geradores consideram todos os cenÃ¡rios escolhidos!</p>
      <div class="scenario-list">
      </div>
      <button id="close-scenarios-modal" class="close-btn">Fechar</button>
    </div>
  </section>

  <!-- Modal: Regras -->  
  <section id="modal-rules" class="modal hidden">
    <div class="modal-content">
      <h2>Regras Dominus</h2>
      <div class="rules-content">
        <p>Estas sÃ£o as regras do sistema <strong>Dominus</strong>.</p>
      
        <ol>
          <li>
            <strong>PreparaÃ§Ã£o:</strong>
            <p>
              Escolha <em>Trama</em> no menu de aÃ§Ãµes.
              Depois, escolha <em>ArquÃ©tipo</em> e dÃª um nome para seu personagem.
            </p>
          </li>
      
          <li>
            <strong>HistÃ³ria:</strong>
            <p>
              Para comeÃ§ar sua histÃ³ria, escolha <em>Cena</em> no menu de aÃ§Ãµes. A histÃ³ria comeÃ§a no <em>Lugar</em>. Role um dado para cada cena.
            </p>
            <ul>
              <li>Se cair 3 ou menos, aparece o <em>Personagem</em>.</li>
              <li>Se cair 4 ou mais, acontece o <em>Evento</em>.</li>
            </ul>
            <p>VocÃª pode ir para uma nova cena se achar apropriado (e tenha resolvido qualquer conflito aparente).</p>
          </li>
      
          <li>
            <strong>Desafio:</strong>
            <p>
              Sempre que seu personagem tentar fazer algo que possa dar errado, role 1d6:
            </p>
            <ul>
              <li>Se o resultado for 4 ou mais, vocÃª conseguiu vencÃª-lo.</li>
              <li>Se houver <em>vantagem</em>, vocÃª poderÃ¡ rolar 2d6 e ficar com o melhor.</li>
              <li>Se houver <em>desvantagem</em>, role 2d6 e fique com o pior.</li>
            </ul>
          </li>
      
          <li>
            <strong>Dilema:</strong>
            <p>
              Sempre que tiver uma dÃºvida cuja resposta nÃ£o seja Ã³bvia, determine duas opÃ§Ãµes possÃ­veis (sim ou nÃ£o, esquerda ou direita, acontece A ou acontece B etc) e role um dado. Se cair 3 ou menos Ã© a primeira opÃ§Ã£o, e se cair 4 ou mais Ã© a segunda opÃ§Ã£o.
            </p>
          </li>
      
          <li>
            <strong>Banco de Ideias e Extras:</strong>
            <p>
              Sempre que quiser elaborar melhor um Lugar, Personagem ou Evento, selecione â€œBanco de Ideiasâ€ ou "Extras" e interprete o resultado conforme o <strong>CenÃ¡rio</strong>.
            </p>
          </li>
      
        </ol>
      </div>
      <button id="close-rules-modal" class="close-btn">Fechar</button>
    </div>
  </section>

  <!-- Modal: Sobre -->
  <section id="modal-about" class="modal hidden">
    <div class="modal-content">
      <h2>Sobre</h2>
      <p>Bem-vindo ao Codex Dominus, um sistema genÃ©rico, minimalista e narrativo para RPG solo. Aqui vocÃª serÃ¡ guiado por menus de aÃ§Ã£o que sorteiam os elementos do jogo, como Tramas, ArquÃ©tipos, Cenas e muito mais, sempre de acordo com os cenÃ¡rios escolhidos. Basta interagir com o chat, que registrarÃ¡ todas as suas decisÃµes, enquanto vocÃª constrÃ³i a histÃ³ria, cria personagens e enfrenta desafios. Prepare-se para uma experiÃªncia totalmente customizÃ¡vel e Ãºnica!</p><br>
      <p>Se vocÃª gostou da jornada, uma cerveja na taverna Ã© uma recompensa justa!</p><br>
      <p><em>Chave Pix: 00b231c7-93ca-4dfc-ab1d-f00a3dbf0916</em></p><br>
      <p style="text-align: right"><small><em>Ver.: 1.0.0</em></small></p>
      <button id="close-about-modal" class="close-btn">Fechar</button>
    </div>
  </section>

  <!-- Modal: ConfiguraÃ§Ãµes -->
  <section id="modal-settings" class="modal hidden">
    <div class="modal-content">
      <h2>ConfiguraÃ§Ãµes</h2>

      <!-- SeÃ§Ã£o de ExportaÃ§Ã£o -->
      <div class="settings-section">
        <h3>Exportar</h3>
        <button type="button" id="btn-export-pdf" aria-label="Exportar como PDF">ğŸ“„ Exportar como PDF</button>
        <button type="button" id="btn-export-txt" aria-label="Exportar como TXT">ğŸ“„ Exportar como TXT</button>
      </div>
      <hr>

      <!-- SeÃ§Ã£o de Backup -->
      <div class="settings-section">
        <h3>Backup</h3>
        <button type="button" id="btn-export-backup" aria-label="Exportar Backup">ğŸ“¤ Exportar Backup</button>
        <label for="import-backup" class="backup-label" aria-label="Importar Backup">ğŸ“¥ Importar Backup</label>
        <input type="file" id="import-backup" class="hidden" accept=".bkp" />
      </div>
      <hr>

      <!-- SeÃ§Ã£o de Armazenamento -->
      <div class="settings-section">
        <h3>Armazenamento</h3>
        <div class="storage-info">
          <div class="progress-bar">
            <div class="progress" id="storage-progress"></div>
          </div>
          <p id="storage-text">0 KB de 5120 KB usados</p>
        </div>
      </div>
      <hr>

      <button id="close-settings-modal" class="close-btn">Fechar</button>
    </div>
  </section>

  <!-- BotÃ£o Flutuante -->
  <button id="btn-profile" class="floating-btn">
    <img id="profile-img" src="character.png" alt="Perfil">
  </button>

  <!-- Modal de Perfil -->
  <section id="modal-profile" class="modal hidden">
    <div class="modal-content">
      <h2>Personagem</h2>
      <div class="tabs">
        <button class="tab-btn active" data-tab="perfil">ğŸ‘¤</button>
        <button class="tab-btn" data-tab="inventario">ğŸ’</button>
        <button class="tab-btn" data-tab="historico">ğŸ“œ</button>
        <button class="tab-btn" data-tab="anotacoes">ğŸ“</button>
      </div>
      <div class="tab-content">
        <div id="perfil" class="tab-pane active">
          <textarea placeholder="Seu Perfil..."></textarea>
        </div>
        <div id="inventario" class="tab-pane">
          <textarea placeholder="Seu InventÃ¡rio..."></textarea>
        </div>
        <div id="historico" class="tab-pane">
          <textarea placeholder="Seu HistÃ³rico..."></textarea>
        </div>
        <div id="anotacoes" class="tab-pane">
          <textarea placeholder="Suas AnotaÃ§Ãµes..."></textarea>
        </div>
      </div>
      <button id="close-profile-modal" class="close-btn">Fechar</button>
    </div>
  </section>

  <!-- Javascripts -->
  <script src="jquery-3.7.1.min.js"></script>
  <script src="scenarios.js"></script>
  <script src="script.js"></script>
  <script src="html2pdf.bundle.min.js"></script>

  <!-- Service Worker -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('service-worker.js').then(() => {
          console.log('Service Worker registrado com sucesso!');
        }).catch(error => {
          console.log('Falha ao registrar o Service Worker:', error);
        });
      });
    }
  </script>
  
</body>
</html>