<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Codex Dominus</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#3f51b5" />
  <link rel="icon" href="icon-192.png" />
</head>
<body>

  <div id="chat-container">

    <!-- Banner de Instalação -->
    <div id="install-banner" class="hidden">
      <span id="close-install-banner">✖</span>
      <button id="btn-install">📲 Instalar Codex Dominus</button>
    </div>

    <!-- Chat -->
    <div id="messages"></div>

    <!-- Barra Inferior -->
    <form id="chat-form">

      <!-- Menu de Ações -->
      <div id="action-container">
        <button type="button" id="open-actions" title="Ações">🎲</button>
        <div id="action-menu" class="hidden">
          <button type="button" class="settings-option" id="btn-scenarios">🌍 Cenários</button>
          <hr>
          <button type="button" class="action-option" data-action="plot">📜 Trama</button>
          <button type="button" class="action-option" data-action="archetype">🧙 Arquétipo</button>
          <button type="button" class="action-option" data-action="scene">🎬 Cena</button>
          <button type="button" class="action-option" data-action="idea-bank">💡 Banco de Ideias</button>
          <button type="button" class="action-option" data-action="extras">✨ Extras</button>
          <hr>
          <button type="button" class="action-option" data-action="roll-1d6">🎲 Rolar 1d6</button>
          <button type="button" class="action-option" data-action="roll-2d6">🎲 Rolar 2d6</button>
          <button type="button" class="action-option" data-action="ask-oracle">🔮 Oráculo</button>
        </div>
      </div>

      <!-- Input de mensagem -->
      <input type="text" id="message-input" placeholder="Digite sua mensagem..." autocomplete="off" inputmode="text"/>
      <button type="submit"><strong>➤</strong></button>
      
      <!-- Menu de Configurações -->
      <div id="settings-container">
        <button type="button" id="open-settings" title="Configurações">⚙️</button>
        <div id="settings-menu" class="hidden">
          <button type="button" class="settings-option" id="btn-about">ℹ️ Sobre</button>
          <button type="button" class="settings-option" id="btn-rules">📃 Regras</button>
          <hr>
          <button type="button" class="settings-option" id="btn-settings">⚙️ Configurações</button>
          <hr>
          <button type="button" class="settings-option" id="btn-undo">⤺ Desfazer</button>
          <button type="button" class="settings-option" id="btn-clear">🗑️ Limpar</button>
        </div>
      </div>

    </form>

  </div>

  <!-- Modal: Cenários -->
  <section id="modal-scenarios" class="modal hidden">
    <div class="modal-content">
      <h2>Cenários Codex Dominus</h2>
      <p>Escolha entre 1 e 3 cenários para jogar. Os geradores consideram todos os cenários escolhidos!</p>
      <div class="scenario-list">
      </div>
      <button id="close-scenarios-modal" class="close-btn">Fechar</button>
    </div>
  </section>

  <!-- Modal: Regras -->  
  <section id="modal-rules" class="modal hidden">
    <div class="modal-content">
      <h2>Regras Dominus</h2>
      <div class="rules-content">
        <p>Estas são as regras do sistema <strong>Dominus</strong>.</p>
      
        <ol>
          <li>
            <strong>Preparação:</strong>
            <p>
              Escolha <em>Trama</em> no menu de ações.
              Depois, escolha <em>Arquétipo</em> e dê um nome para seu personagem.
            </p>
          </li>
      
          <li>
            <strong>História:</strong>
            <p>
              Para começar sua história, escolha <em>Cena</em> no menu de ações. A história começa no <em>Lugar</em>. Role um dado para cada cena.
            </p>
            <ul>
              <li>Se cair 3 ou menos, aparece o <em>Personagem</em>.</li>
              <li>Se cair 4 ou mais, acontece o <em>Evento</em>.</li>
            </ul>
            <p>Você pode ir para uma nova cena se achar apropriado (e tenha resolvido qualquer conflito aparente).</p>
          </li>
      
          <li>
            <strong>Desafio:</strong>
            <p>
              Sempre que seu personagem tentar fazer algo que possa dar errado, role 1d6:
            </p>
            <ul>
              <li>Se o resultado for 4 ou mais, você conseguiu vencê-lo.</li>
              <li>Se houver <em>vantagem</em>, você poderá rolar 2d6 e ficar com o melhor.</li>
              <li>Se houver <em>desvantagem</em>, role 2d6 e fique com o pior.</li>
            </ul>
          </li>
      
          <li>
            <strong>Dilema:</strong>
            <p>
              Sempre que tiver uma dúvida cuja resposta não seja óbvia, determine duas opções possíveis (sim ou não, esquerda ou direita, acontece A ou acontece B etc) e role um dado. Se cair 3 ou menos é a primeira opção, e se cair 4 ou mais é a segunda opção.
            </p>
          </li>
      
          <li>
            <strong>Banco de Ideias e Extras:</strong>
            <p>
              Sempre que quiser elaborar melhor um Lugar, Personagem ou Evento, selecione “Banco de Ideias” ou "Extras" e interprete o resultado conforme o <strong>Cenário</strong>.
            </p>
          </li>
      
        </ol>
      </div>
      <button id="close-rules-modal" class="close-btn">Fechar</button>
    </div>
  </section>

  <!-- Modal: Sobre -->
  <section id="modal-about" class="modal hidden">
    <div class="modal-content">
      <h2>Sobre</h2>
      <p>Bem-vindo ao Codex Dominus, um sistema genérico, minimalista e narrativo para RPG solo. Aqui você será guiado por menus de ação que sorteiam os elementos do jogo, como Tramas, Arquétipos, Cenas e muito mais, sempre de acordo com os cenários escolhidos. Basta interagir com o chat, que registrará todas as suas decisões, enquanto você constrói a história, cria personagens e enfrenta desafios. Prepare-se para uma experiência totalmente customizável e única!</p><br>
      <p>Se você gostou da jornada, uma cerveja na taverna é uma recompensa justa!</p><br>
      <p><em>Chave Pix: 00b231c7-93ca-4dfc-ab1d-f00a3dbf0916</em></p><br>
      <p style="text-align: right"><small><em>Ver.: 1.0.0</em></small></p>
      <button id="close-about-modal" class="close-btn">Fechar</button>
    </div>
  </section>

  <!-- Modal: Configurações -->
  <section id="modal-settings" class="modal hidden">
    <div class="modal-content">
      <h2>Configurações</h2>

      <!-- Seção de Exportação -->
      <div class="settings-section">
        <h3>Exportar</h3>
        <button type="button" id="btn-export-pdf" aria-label="Exportar como PDF">📄 Exportar como PDF</button>
        <button type="button" id="btn-export-txt" aria-label="Exportar como TXT">📄 Exportar como TXT</button>
      </div>
      <hr>

      <!-- Seção de Backup -->
      <div class="settings-section">
        <h3>Backup</h3>
        <button type="button" id="btn-export-backup" aria-label="Exportar Backup">📤 Exportar Backup</button>
        <label for="import-backup" class="backup-label" aria-label="Importar Backup">📥 Importar Backup</label>
        <input type="file" id="import-backup" class="hidden" accept=".bkp" />
      </div>
      <hr>

      <!-- Seção de Armazenamento -->
      <div class="settings-section">
        <h3>Armazenamento</h3>
        <div class="storage-info">
          <div class="progress-bar">
            <div class="progress" id="storage-progress"></div>
          </div>
          <p id="storage-text">0 KB de 5120 KB usados</p>
        </div>
      </div>
      <hr>

      <button id="close-settings-modal" class="close-btn">Fechar</button>
    </div>
  </section>

  <!-- Botão Flutuante -->
  <button id="btn-profile" class="floating-btn">
    <img id="profile-img" src="character.png" alt="Perfil">
  </button>

  <!-- Modal de Perfil -->
  <section id="modal-profile" class="modal hidden">
    <div class="modal-content">
      <h2>Personagem</h2>
      <div class="tabs">
        <button class="tab-btn active" data-tab="perfil">👤</button>
        <button class="tab-btn" data-tab="inventario">🎒</button>
        <button class="tab-btn" data-tab="historico">📜</button>
        <button class="tab-btn" data-tab="anotacoes">📝</button>
      </div>
      <div class="tab-content">
        <div id="perfil" class="tab-pane active">
          <textarea placeholder="Seu Perfil..."></textarea>
        </div>
        <div id="inventario" class="tab-pane">
          <textarea placeholder="Seu Inventário..."></textarea>
        </div>
        <div id="historico" class="tab-pane">
          <textarea placeholder="Seu Histórico..."></textarea>
        </div>
        <div id="anotacoes" class="tab-pane">
          <textarea placeholder="Suas Anotações..."></textarea>
        </div>
      </div>
      <button id="close-profile-modal" class="close-btn">Fechar</button>
    </div>
  </section>

  <!-- Javascripts -->
  <script src="jquery-3.7.1.min.js"></script>
  <script src="scenarios.js"></script>
  <script src="script.js"></script>
  <script src="html2pdf.bundle.min.js"></script>

  <!-- Service Worker -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('service-worker.js').then(() => {
          console.log('Service Worker registrado com sucesso!');
        }).catch(error => {
          console.log('Falha ao registrar o Service Worker:', error);
        });
      });
    }
  </script>
  
</body>
</html>